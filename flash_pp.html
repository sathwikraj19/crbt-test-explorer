<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mini Gantt Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f3f4f6;
    }
    .wrapper {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 12px;
    }
    .header-row {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 1fr;
      font-size: 11px;
      text-align: center;
      color: #6b7280;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 4px;
      margin-bottom: 8px;
    }
    .header-day { border-left: 1px solid #e5e7eb; }

    .row {
      position: relative;
      height: 60px;
      border-top: 1px solid #e5e7eb;
    }

    .task-bar {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      height: 22px;
      border-radius: 999px;
      background: #6366f1;
      color: #f9fafb;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 0 4px;
      box-shadow: 0 8px 16px rgba(15,23,42,0.2);
      cursor: grab;
      user-select: none;
    }
    .task-bar:active { cursor: grabbing; }
    .pill {
      background: rgba(15,23,42,0.2);
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }
    .resize {
      width: 6px;
      height: 70%;
      border-radius: 999px;
      background: #fff;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.25);
      cursor: ew-resize;
      flex-shrink: 0;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h3>Mini Gantt – November 2025 (test)</h3>
    <div class="header-row" id="headerRow"></div>
    <div class="row" id="row1"></div>
  </div>

  <script>
    // Simple, fixed: November 2025 (1..30)
    const TOTAL_DAYS = 30;
    const headerRow = document.getElementById("headerRow");
    for (let d = 1; d <= TOTAL_DAYS; d++) {
      const div = document.createElement("div");
      div.className = "header-day";
      div.textContent = d;
      headerRow.appendChild(div);
    }

    // One test task: 5–12 Nov
    let task = { startDay: 5, endDay: 12, title: "Flash Config", status: "On-Going" };

    const rowEl = document.getElementById("row1");

    function positionBar(bar, startDay, endDay) {
      const left = (startDay - 1) / TOTAL_DAYS * 100;
      const width = (endDay - startDay + 1) / TOTAL_DAYS * 100;
      bar.style.left = left + "%";
      bar.style.width = width + "%";
    }

    function renderTask() {
      rowEl.innerHTML = "";
      const bar = document.createElement("div");
      bar.className = "task-bar";
      bar.innerHTML = `
        <span class="resize left resize"></span>
        <span class="pill">${task.status}</span>
        <span>${task.title}</span>
        <span class="resize right resize"></span>
      `;
      rowEl.appendChild(bar);
      positionBar(bar, task.startDay, task.endDay);

      attachDrag(bar);
    }

    let drag = null;

    function attachDrag(bar) {
      bar.addEventListener("mousedown", e => {
        e.preventDefault();
        const rect = rowEl.getBoundingClientRect();
        const dayW = rect.width / TOTAL_DAYS;
        let mode = "move";
        if (e.target.classList.contains("left")) mode = "left";
        else if (e.target.classList.contains("right")) mode = "right";

        drag = {
          mode,
          startX: e.clientX,
          dayW,
          startDay: task.startDay,
          endDay: task.endDay
        };

        document.addEventListener("mousemove", onMove);
        document.addEventListener("mouseup", onUp);
      });
    }

    function onMove(e) {
      if (!drag) return;
      const dx = e.clientX - drag.startX;
      const dDays = Math.round(dx / drag.dayW);

      let s = drag.startDay;
      let eDay = drag.endDay;

      if (drag.mode === "move") {
        const dur = drag.endDay - drag.startDay;
        s = drag.startDay + dDays;
        eDay = s + dur;
        if (s < 1) { s = 1; eDay = s + dur; }
        if (eDay > TOTAL_DAYS) { eDay = TOTAL_DAYS; s = eDay - dur; }
      } else if (drag.mode === "left") {
        s = drag.startDay + dDays;
        if (s < 1) s = 1;
        if (s >= eDay) s = eDay - 1;
      } else if (drag.mode === "right") {
        eDay = drag.endDay + dDays;
        if (eDay > TOTAL_DAYS) eDay = TOTAL_DAYS;
        if (eDay <= s) eDay = s + 1;
      }

      task.startDay = s;
      task.endDay = eDay;
      const bar = rowEl.querySelector(".task-bar");
      positionBar(bar, s, eDay);
    }

    function onUp() {
      drag = null;
      document.removeEventListener("mousemove", onMove);
      document.removeEventListener("mouseup", onUp);
    }

    // Initial render
    renderTask();
  </script>
</body>
</html>
